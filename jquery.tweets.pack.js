(function($){var k='tweets';function TweetsPlugin(){this._defaults={username:'ev',cycle:false,count:5,animateDuration:6000,singleRandomTweet:false,animate:true,showTimestamps:true}}$.extend(TweetsPlugin.prototype,{markerClassName:'hasTweetsPlugin',baseUrl:'http://twitter.com',api_method:'http://twitter.com/statuses/user_timeline/',urlRegex:/((ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?)/,usernameRegex:/(@)(\w+)/g,requestUrl:"",responseData:null,setDefaults:function(a){$.extend(this._defaults,a||{});return this},_attachTweetsPlugin:function(a,b){a=$(a);if(a.hasClass(this.markerClassName)){return}a.addClass(this.markerClassName);a.hide();var c={settings:$.extend({},this._defaults)};$.data(a[0],k,c);this._fetchTwitterData(a,b)},_fetchTwitterData:function(b,c){var d=$.data(b[0],k);$.extend(d.settings,c);this.requestUrl=this.api_method+d.settings.username+'.json?count='+d.settings.count+'&callback=?';var e=this;$.getJSON(this.requestUrl,function(a){e.responseData=a;e._buildMarkupFromData(b,a)})},_buildMarkupFromData:function(c,d){var e=$.data(c[0],k);var f=this;var g='';if(e.settings.singleRandomTweet){var h=d[Math.floor(Math.random()*d.length)];var j='<li>'+f._buildTweetText(h)+'<span class="created_at">'+f._buildTweetTimestamp(c,h)+'</span></li>';g+=j}else{$.each(d,function(i,a){var b='<li>'+f._buildTweetText(a)+'<span class="created_at">'+f._buildTweetTimestamp(c,a)+'</span></li>';g+=b})}$('<ul/>').html(g).appendTo(c);this._displayTweets(c)},_buildTweetText:function(a){var b=a.text;var c=this;b=c._autoLinkText(b);b=c._autoLinkUsernames(b);return b},_buildTweetTimestamp:function(a,b){var c=$.data(a[0],k);var d=this;var e="";if(c.settings.showTimestamps){e=d._autoLinkTimestamp(b.id_str,b.created_at,b.user.screen_name)}return e},_autoLinkText:function(a){if(this.urlRegex.test(a)){return a.replace(this.urlRegex,"<a href='$1'>$1</a>")}else{return a}},_autoLinkUsernames:function(a){if(this.usernameRegex.test(a)){return a.replace(this.usernameRegex,"$1<a href='http://twitter.com/$2'>$2</a>")}else{return a}},_autoLinkTimestamp:function(a,b,c){var d=new Date(b),dateString=[d.getMonth()+1,d.getDate(),d.getFullYear()].join('/');var e=[this.baseUrl,c,'status',a].join('/');return"<a href='"+e+"'>"+dateString+"</a>"},_displayTweets:function(a){var b=$.data(a[0],k);var c=this;if(b.settings.animate&&b.settings.cycle){c._cycleTweets(a)}else if(b.settings.animate){a.fadeIn()}else{a.show()}},_cycleTweets:function(b){var c=$.data(b[0],k);b.show();b.find('ul > li').hide();b.find('ul > li:first').fadeIn();var i=1;setInterval(function(){var a=b.find('li');a.hide();a.eq(i).fadeIn();if(i==a.length){b.find('ul > li:first').fadeIn();i=1}else{i++}},c.settings.animateDuration)}});var l=['settings'];$.fn.tweets=function(a){var b=Array.prototype.slice.call(arguments,1);if($.inArray(a,l)>-1){return $.tweets['_'+a+'TweetsPlugin'].apply($.tweets,[this[0]].concat(b))}return this.each(function(){if(typeof a=='string'){$.tweets['_'+a+'TweetsPlugin'].apply($.tweets,[this].concat(b))}else{$.tweets._attachTweetsPlugin(this,a||{})}})};$.tweets=new TweetsPlugin()})(jQuery);
